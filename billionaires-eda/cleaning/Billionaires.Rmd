---
title: "Cleaning Billionairse"
output:
  html_document:
    df_print: paged
  pdf_document:
    latex_engine: xelatex
output_dir: "/Users/jacob/Final Project/cleaning_binionaires"
---


```{r setup, include=FALSE}
options(scipen=999)
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(stringr)
library(tidyverse)
library(rvest)
library(curl)
```

## ***Attributing and sorting variables:***

### Part 1: Create tibble and cross-reference variable names with Forbes list

```{r}
billionaires=read_csv("billionaires.csv")
names(billionaires)
```

**Conclusion**: variables from Forbes 2023 spreadsheet include (identical/derivative variables seperated by "/"): *"rank", "finalWorth", "category"/"industries",  “personName"/”lastName"/"firstName", "age", "title", "organization", "status" (rank up/down from 2022), "selfMade", "country"/"countryOfCitizenship", "city", ”state”, ”source”, ”gender”, "date" (date of sample)*

### Part 2: Summarize economic variables to make finding year from World Bank data easier

```{r}
bill_econ_data <- billionaires %>% 
  select(country, contains("_")) %>%
  group_by(country) %>%
  summarize(cpi=mean(cpi_country),
          cpi_change=mean(cpi_change_country),
          tert_ed=mean(gross_tertiary_education_enrollment),
          prim_ed=mean(gross_primary_education_enrollment_country),
          lifespan=mean(life_expectancy_country),
          tax_revenue=mean(tax_revenue_country_country),
          tax_rate=mean(total_tax_rate_country),
          population=mean(population_country),
          lat=mean(latitude_country),
          lon=mean(longitude_country),
          count=n()) %>%
  ungroup()

arrange(bill_econ_data, desc(count))
```

**Conclusion:** All of these variables represent economic indicators that can be sourced from World Bank's data sets. When cross-referencing the numbers, I found that they all matched World Bank's data from 2017. Since this is outdated information, their values will be removed and instead joined with the sets with the matching 2023 data.

### Part 3: Remove remaining irrelevant variables

```{r}
billionaires1 <- billionaires %>%
                  select(-birthDate, -birthYear, -birthMonth, -birthDay, -residenceStateRegion, -firstName, -lastName,-date) %>%
                  select(-industries,-countryOfCitizenship,-organization)
```

**Conclusion:** *"birthDate", "birthYear","birthMonth","birthDay", "residenceStateRegion", "date"* are unnecessary since age is already included along with location variables, and date is irrelevant because it just identifies the time the Forbes data was collected (4/4/2023  5:01:00 AM). These variables do not add to the meaning of the data, so they are removed. Additionally, since *firstName* and *lastName* are derivative of and don't contribute more than the identifier *personName*, so remove the former two. *organization* is also removed since it is largely irrelevant to our analysis. Lastly, remove the identical/derivative variables identified in Part 1.

### Part 4: Arrange Forbes variables to be more helpful

```{r}
billionaires2 <- billionaires1 %>%
                  select(personName, rank, finalWorth, age, gender, country, state, city, category, selfMade, title, source, status)
```

**Conclusion:** Arranged variables by personal info, then business info. More recent economic indicators we want will be found and joined next, so those columns are not selected.


## ***Resourcing/joining economic variables***

### Part 1: Cleaning/writing necessary values

```{r}
# cpi: 
cpi=read_csv("econ2022/cpi/cpi.csv")
cpi1 <- cpi %>%
  rename(country=`Country Name`) %>%
  select(country, `2022`) %>%
  rename(cpi_country=`2022`) 
  
write_csv(cpi1, "econ2022/cpi/cpi22.csv")

# cpi change (2021-2022): 
cpic=read_csv("econ2022/cpi/cpi.csv")
cpic1 <- cpic %>%
  rename(country=`Country Name`) %>%
  select(country, `2021`, `2022`) %>%
  transmute(country=country, `2022`=`2022`-`2021`) %>%
  rename(cpi_change_country=`2022`) 
  
write_csv(cpic1, "econ2022/cpi/cpichange22.csv")

# gdp:
gdp=read_csv("econ2022/gdp/gdp.csv")
gdp1 <- gdp %>%
  rename(country=`Country Name`) %>%
  select(country, `2022`) %>%
  rename(gdp_country=`2022`) 
  
write_csv(gdp1, "econ2022/gdp/gdp22.csv")

# gdp change (2021-2022):
gdpc=read_csv("econ2022/gdp/gdp.csv")
gdpc1 <- gdpc %>%
  rename(country=`Country Name`) %>%
  select(country, `2021`, `2022`) %>%
  transmute(country=country, `2022`=`2022`-`2021`) %>%
  rename(gdp_change_country=`2022`) 
  
write_csv(gdpc1, "econ2022/gdp/gdpchange22.csv")

# gross primary enrollment:
grossprimenrlmt=read_csv("econ2022/grossprimenrlmt/grossprimenrlmt.csv")
grossprimenrlmt1 <- grossprimenrlmt %>%
  rename(country=`Country Name`) %>%
  select(country, `2022`) %>%
  rename(gross_primary_enrlmt_country=`2022`) 

write_csv(grossprimenrlmt1, "econ2022/grossprimenrlmt/grossprimenrlmt22.csv")

# gross tertiary enrollment:
grosstertenrlmt=read_csv("econ2022/grosstertenrlmt/grosstertenrlmt.csv")
grosstertenrlmt1 <- grossprimenrlmt %>%
  rename(country=`Country Name`) %>%
  select(country, `2022`) %>%
  rename(gross_tertiary_enrlmt_country=`2022`) 

write_csv(grossprimenrlmt1, "econ2022/grosstertenrlmt/grosstertenrlmt22.csv")

# life expectancy:
lifeexpectancy=read_csv("econ2022/lifeexpectancy/lifeexpectancy.csv")
lifeexpectancy1 <- lifeexpectancy %>%
  rename(country=`Country Name`) %>%
  select(country, `2022`) %>%
  rename(life_expectancy_country=`2022`) 

write_csv(lifeexpectancy1, "econ2022/lifeexpectancy/lifeexpectancy22.csv")

# population:
population=read_csv("econ2022/population/population.csv")
population1 <- population %>%
  rename(country=`Country Name`) %>%
  select(country, `2022`) %>%
  rename(population_country=`2022`) 
  
write_csv(population1, "econ2022/population/population22.csv")

# tax rate/revenue: lacking info for 2021-2022, removed from consideration

# NEW VAR: unemployment rate: 
unemployment=read_csv("econ2022/unemployment/unemployment.csv")
unemployment1 <- unemployment %>%
  rename(country=`Country Name`) %>%
  select(country, `2022`) %>%
  rename(unemployment_rate_country=`2022`)
  
write_csv(unemployment1, "econ2022/unemployment/unemployment22.csv")
```

**Conclusion:** Now we have 9 economic indicators for 2022 represented in csv files. Unfortunately there wasn't recent tax rate/revenue data so those variables will be removed, but I added in unemployment rate and GDP change (2021-2022) as other helpful economic indicators. 

### Part 2: Preparing country names for join

```{r}
billionaires2_test <- billionaires2 %>%
                        group_by(country) %>%
                        summarize(mean = n()) %>%
                        ungroup()
cpi1_test <- cpi1 %>%
               group_by(country) %>%
               summarize(mean = n())

anti_join(billionaires2_test, cpi1_test, by="country")

# renaming values:
billionaires3 <- billionaires2 %>%
                      mutate(country = replace(country, country == "Bahamas", "Bahamas, The"),
                                country = replace(country, country == "Czech Republic", "Czechia"),
                                country = replace(country, country == "Egypt", "Egypt, Arab Rep."),
                                country = replace(country, country == "Eswatini (Swaziland)", "Eswatini"),
                                country = replace(country, country == "Hong Kong", "Hong Kong SAR, China"),
                                country = replace(country, country == "Russia", "Russian Federation"),
                                country = replace(country, country == "Slovakia","Slovak Republic"),
                                country = replace(country, country == "South Korea", "Korea, Rep."),
                                country = replace(country, country == "Turkey", "Turkiye"),
                                country = replace(country, country == "Vietnam","Viet Nam"))
```

**Conclusion:** After doing an initial anti_join it was evident 10 country names did not match and had to be changed. Economic indicators for World Bank non-members Guernsey and Taiwan are not included.

### Part 3: Binding and joining economic data

```{r}
billionaires4 <- billionaires3 %>%
                  left_join(cpi1, by="country") %>%
                  left_join(cpic1, by="country") %>%
                  left_join(gdp1, by="country") %>%
                  left_join(gdpc1, by="country") %>%
                  left_join(grossprimenrlmt1, by="country") %>%
                  left_join(grosstertenrlmt1, by="country") %>%
                  left_join(lifeexpectancy1, by="country") %>%
                  left_join(population1, by="country") %>%
                  left_join(unemployment1, by="country")
```

## ***Resourcing/joining location data***

### Part 1: Scrape coordinate data from Google

```{r}
coord_data_url="https://developers.google.com/public-data/docs/canonical/countries_csv"
coord_data = coord_data_url %>%
  read_html() %>%
  html_table(fill=TRUE) %>%
  .[[1]] %>%
  select(name, latitude, longitude) %>%
  rename(country=name)
```

**Conclusion:** Scraped data from Google public data, selected relevant variables and prepped join variable name.

### Part 2: Preparing country names for join

```{r}
billionaires4_test <- billionaires4 %>%
                        group_by(country) %>%
                        summarize(mean = n()) %>%
                        ungroup()
coord_test <- coord_data %>%
               group_by(country) %>%
               summarize(mean = n())

anti_join(billionaires4_test, coord_test, by="country")

# renaming values:
billionaires5 <- billionaires4 %>%
                      mutate(country = replace(country, country == "Bahamas, The", "Bahamas"),
                                country = replace(country, country == "Czechia", "Czech Republic"),
                                country = replace(country, country == "Egypt, Arab Rep.", "Egypt"),
                                country = replace(country, country == "Eswatini", "Swaziland"),
                                country = replace(country, country == "Hong Kong SAR, China", "Hong Kong"),
                                country = replace(country, country == "Russian Federation", "Russia"),
                                country = replace(country, country == "Slovak Republic", "Slovakia"),
                                country = replace(country, country == "Korea, Rep.", "South Korea"),
                                country = replace(country, country == "Turkiye", "Turkey"),
                                country = replace(country, country == "Viet Nam", "Vietnam"))
```

**Conclusion:** After doing an initial anti_join it was evident 10 country names did not match and had to be changed.

### Part 3: Binding and joining coordinate data

```{r}
billionaires6 <- billionaires5 %>%
                  left_join(coord_data, by="country")
```

**Conclusion:** Successful binding of coordinate data.

## ***Final variable name adjustments***

```{r}
billionaires_final <- billionaires6 %>%
                        rename(name=personName, 
                               net_worth=finalWorth,
                               self_made=selfMade,
                               position_change=status,
                               latitude_country=latitude,
                               longitude_country=longitude)
#write_csv(billionaires_final, "billionaires_clean.csv")
```

**Conclusion:** Standardized variable names and wrote final file.
